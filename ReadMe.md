# API меню ресторана

Проект по созданию API меню ресторана

# Стек технологий
 - FastAPI
 - Uvicorn
 - PosgresSQL
 - alembic
 - SQLAlchemy
 - Celery
 - Redis
 - RabbitMQ
 - Docker, docker-compose
 - Linters

# Постановка задачи

Даны 3 сущности: Меню, Подменю, Блюдо. У меню есть подменю, которые к ней привязаны. У подменю есть блюда.
## Условия:
- Блюдо не может быть привязано напрямую к меню, минуя подменю.
- Блюдо не может находиться в 2-х подменю одновременно.
- Подменю не может находиться в 2-х меню одновременно.
- Если удалить меню, должны удалиться все подменю и блюда этого меню.
- Если удалить подменю, должны удалиться все блюда этого подменю.
- Цены блюд выводить с округлением до 2 знаков после запятой.
- Во время выдачи списка меню, для каждого меню добавлять кол-во подменю и блюд в этом меню.
- Во время выдачи списка подменю, для каждого подменю добавлять кол-во блюд в этом подменю.
- Во время запуска тестового сценария БД должна быть пуста.
## Дополнительные задачи и требования:
- Код должен соответствовать принципам SOLID, DRY, KISS.
- Проект должен быть завернут в контейнеры
- Проект должен запускаться по одной команде, тесты - по другой.
- Добавить в проект фоновую задачу с помощью Celery + RabbitMQ по импорту меню в excel-файл.
- Данные меню, подменю, блюд для генераций excel-файла, должны доставаться одним ORM-запросом в БД.
- Код должен проходить все линтеры (black, autopep, flake8, mypy, isort).


# Установка и запуск

- Скачать репозиторий проекта
```bash
git clone https://github.com/expmax85/Test_app.git
```

- Переместиться в корень проекта и установить зависимости:
```bash
cd Test_app
pip install -r requirements.txt
```

- Подключить базу данных, заполнить файл .env.

- Выполнить миграции командой:
```bash
alembic upgrade head
```

- Запустить проект командой:
 ```bash
uvicorn src.main:app --reload
```

# Docker
### Запуск приложения через докер
```bash
docker compose --env-file ./conf/.env.main up -d
```

### Запуск приложения в режиме тестирования
```bash
docker compose -f docker-compose-test.yml --env-file ./conf/.env.test up
```
# Openapi
### Документация OpenAPI:
```
/docs
```
### Генерация тестовых данных
```
/api/v1/generate
```
### Создание задачи по импорту меню в xls-файл:
```
/api/v1/tasks/import
```
### Получение файла/статуса выполнения задачи по ее `task_id`:
```
/api/v1/tasks/status/{task_id}
```
